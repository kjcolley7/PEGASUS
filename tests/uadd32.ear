.import "test_suite.ear"

/*
u32 uadd32(u32 x, u32 y) {
	u16 xl = LO16(x); //A0
	u16 xh = HI16(x); //A1
	u16 yl = LO16(y); //A2
	u16 yh = HI16(y); //A3
	
	xl += yl;
	xh = xy + yh + CARRY;
	
	// Result in A0:A1
	return __PAIR__(LO16=xl, HI16=xh);
}
*/
.scope
.export @uadd32
@uadd32: //LEAF
	ADD    A0, A2
	ADC    A1, A3
	RET


.scope
@test:
	PSH     {FP, RA, RD}
	
	// assert(0x44332211 + 0x12345678 == 0x56677889);
	MOV     A0, 0x2211
	MOV     A1, 0x4433
	MOV     A2, 0x5678
	MOV     A3, 0x1234
	FCR     @uadd32
	CMP     A0, 0x7889
	BPT.NE
	ORR.NE  S2, 1 << 0
	CMP     A1, 0x5667
	BPT.NE
	ORR.NE  S2, 1 << 1
	
	// assert(0x7FFFFFFF + 0x00000001 == 0x80000000);
	MOV     A0, 0xFFFF
	MOV     A1, 0x7FFF
	MOV     A2, 0x0001
	MOV     A3, 0x0000
	FCR     @uadd32
	CMP     A0, 0x0000
	BPT.NE
	ORR.NE  S2, 1 << 2
	CMP     A1, 0x8000
	BPT.NE
	ORR.NE  S2, 1 << 3
	
	POP     {FP, PC, DPC}
